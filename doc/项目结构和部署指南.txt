# AI ä¸“åˆ©è‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿ - å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
patent-generator/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ patent_generator.py      # æ ¸å¿ƒç”Ÿæˆç³»ç»Ÿ(å¤šè§’è‰²åä½œ)
â”‚   â”œâ”€â”€ app.py                   # Flask API æœåŠ¡å™¨
â”‚   â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â”‚   â””â”€â”€ config.py               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ index.html              # Web å‰ç«¯ç•Œé¢
â”œâ”€â”€ temp_patent/                # Claude Code å·¥ä½œç›®å½•
â”œâ”€â”€ uploads/                    # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ outputs/                    # ç”Ÿæˆçš„ä¸“åˆ©æ–‡æ¡£
â”œâ”€â”€ docker-compose.yml          # Docker éƒ¨ç½²é…ç½®
â”œâ”€â”€ Dockerfile                  # Docker é•œåƒ
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

## ğŸ“¦ å®‰è£…å’Œé…ç½®

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†æˆ–åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir patent-generator && cd patent-generator

# å®‰è£… Claude Code CLI
npm install -g @anthropic-ai/claude-code

# æˆ–ä½¿ç”¨ pip (å¦‚æœæ”¯æŒ)
pip install claude-code

# éªŒè¯å®‰è£…
claude --version
```

### 2. Python ä¾èµ–

åˆ›å»º `requirements.txt`:

```txt
flask==3.0.0
flask-cors==4.0.0
anthropic==0.18.1
python-dotenv==1.0.0
```

å®‰è£…ä¾èµ–:

```bash
pip install -r requirements.txt
```

### 3. é…ç½® API Key

åˆ›å»º `.env` æ–‡ä»¶:

```env
ANTHROPIC_API_KEY=your_api_key_here
FLASK_ENV=development
FLASK_DEBUG=True
```

æˆ–è€…è®¾ç½®ç¯å¢ƒå˜é‡:

```bash
export ANTHROPIC_API_KEY="your_api_key_here"
```

## ğŸš€ è¿è¡Œæ–¹å¼

### æ–¹å¼ 1: ç›´æ¥è¿è¡Œ

```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd backend
python app.py

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯,å¯åŠ¨å‰ç«¯(ç®€å•æ–¹å¼)
cd frontend
python -m http.server 8080
```

è®¿é—®: `http://localhost:8080`

### æ–¹å¼ 2: ä½¿ç”¨ Docker

åˆ›å»º `Dockerfile`:

```dockerfile
FROM python:3.11-slim

# å®‰è£… Node.js (for Claude Code)
RUN apt-get update && apt-get install -y \
    nodejs npm curl tree \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£… Claude Code
RUN npm install -g @anthropic-ai/claude-code

WORKDIR /app

# å®‰è£… Python ä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# åˆ›å»ºå¿…è¦çš„ç›®å½•
RUN mkdir -p temp_patent uploads outputs

EXPOSE 5000

CMD ["python", "backend/app.py"]
```

åˆ›å»º `docker-compose.yml`:

```yaml
version: '3.8'

services:
  patent-generator:
    build: .
    ports:
      - "5000:5000"
      - "8080:8080"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    volumes:
      - ./outputs:/app/outputs
      - ./temp_patent:/app/temp_patent
      - ./uploads:/app/uploads
    restart: unless-stopped
```

è¿è¡Œ:

```bash
docker-compose up -d
```

### æ–¹å¼ 3: ç”Ÿäº§éƒ¨ç½²(ä½¿ç”¨ Gunicorn)

```bash
# å®‰è£… Gunicorn
pip install gunicorn

# å¯åŠ¨æœåŠ¡
gunicorn -w 4 -b 0.0.0.0:5000 backend.app:app
```

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### å‘½ä»¤è¡Œæ–¹å¼

#### ä»ä»£ç ç”Ÿæˆä¸“åˆ©

```bash
python backend/patent_generator.py code ./my-project 3
```

å‚æ•°è¯´æ˜:
- `code`: æ¨¡å¼(ä»ä»£ç ç”Ÿæˆ)
- `./my-project`: ä»£ç ç›®å½•è·¯å¾„
- `3`: è¿­ä»£æ¬¡æ•°

#### ä»åˆ›æ„ç”Ÿæˆä¸“åˆ©

```bash
python backend/patent_generator.py idea 5
```

### API æ–¹å¼

#### 1. ä»ä»£ç ç”Ÿæˆ

```bash
curl -X POST http://localhost:5000/api/generate/code \
  -H "Content-Type: application/json" \
  -d '{
    "directory": "./my-project",
    "iterations": 3
  }'
```

#### 2. ä»åˆ›æ„ç”Ÿæˆ

```bash
curl -X POST http://localhost:5000/api/generate/idea \
  -H "Content-Type: application/json" \
  -d '{
    "idea": "ä¸€ç§åŸºäºAIçš„æ™ºèƒ½ä»£ç å®¡æŸ¥ç³»ç»Ÿ...",
    "iterations": 3
  }'
```

#### 3. æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl http://localhost:5000/api/tasks/{task_id}
```

#### 4. ä¸‹è½½ä¸“åˆ©æ–‡æ¡£

```bash
curl -O http://localhost:5000/api/download/{task_id}
```

### Web ç•Œé¢æ–¹å¼

1. è®¿é—® `http://localhost:8080`
2. é€‰æ‹©æ¨¡å¼(ä»ä»£ç  / ä»åˆ›æ„)
3. å¡«å†™ä¿¡æ¯,è®¾ç½®è¿­ä»£æ¬¡æ•°
4. ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"
5. ç­‰å¾…ç”Ÿæˆå®Œæˆ,é¢„è§ˆå’Œä¸‹è½½

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰è§’è‰² Prompt

ä¿®æ”¹ `patent_generator.py` ä¸­çš„ç³»ç»Ÿæç¤º:

```python
class PatentWriter(PatentAgent):
    def __init__(self, client: anthropic.Anthropic):
        system_prompt = """
        ä½ æ˜¯ä¸€ä½èµ„æ·±ä¸“åˆ©ä»£ç†äºº...
        [æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰æç¤ºè¯]
        """
        super().__init__(client, "ä¸“åˆ©æ’°å†™å‘˜", system_prompt)
```

### è°ƒæ•´è¿­ä»£ç­–ç•¥

```python
def _iterative_generation(self, innovation_points, iterations, source_type):
    # å¯ä»¥æ·»åŠ æå‰ç»ˆæ­¢æ¡ä»¶
    for i in range(1, iterations):
        review_data = self._parse_review(review_result)
        
        # å¦‚æœè¯„åˆ†è¶³å¤Ÿé«˜,æå‰ç»“æŸ
        if review_data.get('overall_score', 0) >= 90:
            self.logger.info("âœ… ä¸“åˆ©è´¨é‡å·²è¾¾æ ‡,æå‰ç»“æŸ!")
            break
```

### é›†æˆæ›´å¤šå·¥å…·

åœ¨ `_call_claude_code` æ–¹æ³•ä¸­:

```python
result = subprocess.run([
    'claude',
    '-p', prompt,
    '--permission-mode', 'acceptEdits',
    '--allowedTools', 'Read,Write,Bash,WebSearch',  # æ·»åŠ æ›´å¤šå·¥å…·
    '--output-format', 'json'
], ...)
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—é…ç½®

```python
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s [%(levelname)s] %(name)s - %(message)s',
    handlers=[
        logging.FileHandler('patent_system.log'),
        logging.StreamHandler()
    ]
)
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f patent_system.log

# æŸ¥çœ‹ç‰¹å®šä»»åŠ¡æ—¥å¿—
grep "task_id_here" patent_system.log
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **API Key ä¿æŠ¤**: æ°¸è¿œä¸è¦æäº¤ API Key åˆ°ä»£ç ä»“åº“
2. **è¾“å…¥éªŒè¯**: å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯
3. **æ–‡ä»¶ç³»ç»Ÿéš”ç¦»**: é™åˆ¶ä»£ç åˆ†æçš„ç›®å½•èŒƒå›´
4. **é€Ÿç‡é™åˆ¶**: æ·»åŠ  API è°ƒç”¨é€Ÿç‡é™åˆ¶

```python
from flask_limiter import Limiter

limiter = Limiter(
    app,
    key_func=lambda: request.remote_addr,
    default_limits=["100 per hour"]
)

@app.route('/api/generate/code', methods=['POST'])
@limiter.limit("5 per minute")
def generate_from_code():
    # ...
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—(Celery)

```bash
pip install celery redis
```

```python
from celery import Celery

celery = Celery('tasks', broker='redis://localhost:6379')

@celery.task
def generate_patent_task(task_id, mode, data, iterations):
    # å¼‚æ­¥æ‰§è¡Œç”Ÿæˆä»»åŠ¡
    pass
```

### 2. ç¼“å­˜åˆ›æ–°ç‚¹åˆ†æ

```python
import functools
import hashlib

@functools.lru_cache(maxsize=100)
def analyze_code_cached(code_hash):
    # ç¼“å­˜åˆ†æç»“æœ
    pass
```

### 3. å¹¶è¡Œå¤„ç†(å¤šæ–‡ä»¶åˆ†æ)

```python
from concurrent.futures import ThreadPoolExecutor

with ThreadPoolExecutor(max_workers=5) as executor:
    futures = [executor.submit(analyze_file, f) for f in files]
    results = [f.result() for f in futures]
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: Claude Code å‘½ä»¤æ‰¾ä¸åˆ°

```bash
# æ£€æŸ¥å®‰è£…
which claude

# é‡æ–°å®‰è£…
npm uninstall -g @anthropic-ai/claude-code
npm install -g @anthropic-ai/claude-code
```

### Q2: API é€Ÿç‡é™åˆ¶

```
Error: Rate limit exceeded
```

è§£å†³æ–¹æ¡ˆ:
- å¢åŠ è¿­ä»£é—´éš”æ—¶é—´
- ä½¿ç”¨æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶
- å‡çº§ API è®¡åˆ’

### Q3: ç”Ÿæˆçš„ä¸“åˆ©æ ¼å¼ä¸æ­£ç¡®

- è°ƒæ•´ Prompt,æ›´æ˜ç¡®åœ°æŒ‡å®šæ ¼å¼è¦æ±‚
- å¢åŠ è¿­ä»£æ¬¡æ•°
- æ·»åŠ æ ¼å¼éªŒè¯æ­¥éª¤

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½

### 1. æ·»åŠ ä¸“åˆ©æ£€ç´¢åŠŸèƒ½

é›†æˆä¸“åˆ©æ•°æ®åº“ API,æ£€æŸ¥æ–°é¢–æ€§:

```python
def search_prior_art(keywords):
    # è°ƒç”¨ä¸“åˆ©æ£€ç´¢ API
    pass
```

### 2. å¤šè¯­è¨€æ”¯æŒ

```python
def generate_patent(language='zh-CN'):
    system_prompt = get_prompt_by_language(language)
    # ...
```

### 3. å¯¼å‡ºå¤šç§æ ¼å¼

```python
def export_patent(content, format='md'):
    if format == 'pdf':
        return convert_to_pdf(content)
    elif format == 'docx':
        return convert_to_docx(content)
    # ...
```

## ğŸ“ å¼€å‘è·¯çº¿å›¾

- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] æ”¯æŒå›¢é˜Ÿåä½œ(å¤šç”¨æˆ·åŒæ—¶ç”Ÿæˆ)
- [ ] ä¸“åˆ©æ¨¡æ¿åº“
- [ ] AI è¾…åŠ©ä¸“åˆ©æ£€ç´¢
- [ ] å¯è§†åŒ–æŠ€æœ¯ç‰¹å¾ç¼–è¾‘å™¨
- [ ] å¯¼å‡ºä¸ºæ ‡å‡†ä¸“åˆ©å±€æ ¼å¼
- [ ] é›†æˆä¸“åˆ©ç¿»è¯‘åŠŸèƒ½

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«! ğŸ‰**